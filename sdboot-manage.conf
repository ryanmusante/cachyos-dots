# sdboot-manage configuration
# /etc/sdboot-manage.conf
#
# Configures systemd-boot entry generation for CachyOS.
# Changes require: sudo sdboot-manage gen && sudo sdboot-manage update
#
# Validated: File location and format correct per CachyOS Wiki.
# See: https://wiki.cachyos.org/configuration/boot_manager_configuration/

# ============================================================================
# LINUX_OPTIONS - Kernel command line parameters
# ============================================================================
# These parameters are passed to the kernel at boot.
# View active parameters: cat /proc/cmdline
#
# Parameters explained:
#
#   quiet - Suppress most boot messages (use dmesg to view later)
#
#   8250.nr_uarts=0 - Disable legacy serial port detection
#     Saves ~100ms boot time on systems without serial ports
#
#   amd_iommu=off - Disable IOMMU completely
#     Reduces overhead on systems not using GPU passthrough (VFIO)
#     Change to 'amd_iommu=on iommu=pt' if using VM GPU passthrough
#
#   amd_pstate=active - Enable AMD P-State EPP driver
#     Required for energy_performance_preference control via udev rule
#     See: https://docs.kernel.org/admin-guide/pm/amd-pstate.html
#
#   audit=0 - Disable kernel audit subsystem
#     Reduces overhead; not needed on single-user desktop systems
#
#   amdgpu.cwsr_enable=0 - Disable Compute Wave Save/Restore
#     Strix Halo MES firmware fix; improves stability for some workloads
#
#   amdgpu.gpu_recovery=1 - Enable GPU reset on hang
#     Allows recovery without reboot when GPU hangs
#
#   amdgpu.modeset=1 - Enable kernel mode setting
#     Required for display; enables early KMS
#
#   amdgpu.ppfeaturemask=0xfffd7fff - Enable most PowerPlay features
#     Unlocks GPU power management for performance tuning
#     See: https://wiki.archlinux.org/title/AMDGPU#Boot_parameter
#
#   amdgpu.runpm=0 - Disable runtime power management
#     Keeps GPU always on; appropriate for always-on desktop
#
#   btusb.enable_autosuspend=n - Disable Bluetooth USB autosuspend
#     Prevents connection drops and latency issues with BT devices
#     Note: Kernel module parameters use y/n, not 0/1
#
#   mt7925e.disable_aspm=1 - Disable PCIe ASPM for MediaTek WiFi
#     Strix Halo/MT7925-specific: Fixes stability issues on MT7925 WiFi 7 chipsets
#     Remove if not using MT7925 WiFi chipset (harmless but unnecessary)
#     Verify chipset: lspci | grep -i network
#
#   nmi_watchdog=0 - Disable NMI watchdog
#     Complements nowatchdog; prevents perf counter reservation for watchdog
#
#   nowatchdog - Disable hardware watchdog timers
#     Prevents unnecessary log messages; complements blacklist.conf
#
#   nvme_core.default_ps_max_latency_us=0 - Disable NVMe power saving
#     Prevents NVMe drives from entering low-power states
#     Improves latency at cost of slightly higher idle power
#
#   pci=pcie_bus_perf - Optimize PCIe MPS and MRRS for performance
#     Sets device MPS (Max Payload Size) to the largest allowable value
#     based on parent bus. Also sets MRRS (Max Read Request Size) to the
#     largest supported value for best throughput on PCIe devices.
#     Benefit: Up to 10-15% improvement in NVMe sequential read/write speeds
#     and reduced GPU PCIe latency. Most noticeable on high-bandwidth devices.
#     See: https://github.com/torvalds/linux/blob/master/drivers/pci/Kconfig
#
#   split_lock_detect=off - Disable split lock detection
#     Prevents performance penalties from legacy software using split locks
#     Some games and older applications trigger this (God of War, Street Fighter 6)
#     SECURITY NOTE: Creates DoS vulnerability - malicious software can degrade
#     system performance. Acceptable on single-user gaming desktops only.
#
#   tsc=reliable - Mark TSC (Time Stamp Counter) as reliable
#     Skips TSC validation; safe on modern AMD systems with constant_tsc flag
#     Verify: grep constant_tsc /proc/cpuinfo
#     Safer alternative: tsc=nowatchdog (disables watchdog only)
#
#   usbcore.autosuspend=-1 - Disable USB autosuspend globally
#     Prevents USB devices from entering suspend; improves peripheral reliability
#
#   zswap.enabled=0 - Disable zswap compressed swap cache
#     With 128GB RAM, swap compression overhead isn't beneficial
#     Re-enable on memory-constrained systems
#
# Optional parameters (uncomment in LINUX_OPTIONS if needed):
#
#   iommu=pt - IOMMU passthrough mode
#     Improves performance for devices not used with VFIO passthrough.
#     Required if using GPU passthrough (VFIO) for VMs.
#     Safe to add on all AMD systems; minimal overhead when no passthrough is used.
#     See: https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF
#
LINUX_OPTIONS="quiet 8250.nr_uarts=0 amd_iommu=off amd_pstate=active amdgpu.cwsr_enable=0 amdgpu.gpu_recovery=1 amdgpu.modeset=1 amdgpu.ppfeaturemask=0xfffd7fff amdgpu.runpm=0 audit=0 btusb.enable_autosuspend=n mt7925e.disable_aspm=1 nmi_watchdog=0 nowatchdog nvme_core.default_ps_max_latency_us=0 pci=pcie_bus_perf split_lock_detect=off tsc=reliable usbcore.autosuspend=-1 zswap.enabled=0"

# ============================================================================
# Entry management options
# ============================================================================

# LINUX_FALLBACK_OPTIONS: Options for fallback entries
# Generates a fallback initramfs with minimal filtering for recovery scenarios.
# The fallback skips autodetect, including all drivers for broader hardware support.
LINUX_FALLBACK_OPTIONS="quiet"

# OVERWRITE_EXISTING: Regenerate entries on kernel update
# Ensures boot entries stay current with installed kernels
OVERWRITE_EXISTING="yes"

# REMOVE_OBSOLETE: Delete entries for uninstalled kernels
# Keeps boot menu clean
REMOVE_OBSOLETE="yes"
